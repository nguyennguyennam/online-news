<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
    <%= title %>
  </title>
  <meta name="description" content="<%= description %>" />

  <meta name="og:title" content="<%= title %>" />
  <meta name="og:description" content="<%= description %>" />

  <link rel="stylesheet" href="/css/tailwind.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap"
    rel="stylesheet" />
</head>

<body class="font-nunito">
  <header class="flex flex-col">
    <!-- Title Section -->
    <div class="container mx-auto flex h-36 items-center justify-between px-4 font-playfair">
      <!-- Search Bar -->
      <div class="relative w-1/4">
        <form id="searchForm" action="/search" method="GET">
          <div class="relative">
            <input type="text" name="query" placeholder="Search"
              class="w-full rounded-lg border border-gray-300 py-2 pl-10 pr-4 focus:border-blue-500 focus:outline-none" />
            <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" fill="none"
              viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </div>
        </form>
      </div>

      <!-- Title -->
      <a href="/home" class="flex flex-col items-center justify-center transition-opacity hover:opacity-80">
        <h1 class="text-7xl font-black">The Cipher</h1>
        <p class="mt-2 text-xl italic text-gray-600">
          The world is in your hand
        </p>
      </a>

      <!-- Auth Buttons -->
      <div class="flex w-1/4 justify-end gap-4">
        <% if (typeof User_info !=="undefined" && User_info) { %>
          <!-- User Info Dropdown -->
          <div class="relative">
            <!-- User Button -->
            <button id="userDropdownBtn"
              class="flex items-center gap-2 rounded-full border px-3 py-1 shadow hover:shadow-md focus:outline-none">
              <span class="text-sm font-medium">
                <%= User_info.fullName %>
              </span>
            </button>

            <!-- Dropdown Menu -->
            <div id="userDropdownMenu" class="hidden absolute right-0 mt-2 w-48 rounded-lg bg-white shadow-lg">
              <a href="/profile" class="block px-4 py-2 text-gray-800 hover:bg-gray-100 hover:text-blue-500">
                Profile
              </a>
              <a href="/logout" class="block px-4 py-2 text-gray-800 hover:bg-gray-100 hover:text-blue-500">
                Log Out
              </a>
            </div>
            
          </div>
          <% } else { %>
            <!-- Login and Register Buttons (Guest View) -->
            <a href="/login" class="px-4 py-2 font-semibold text-black hover:text-blue-500">
              Login
            </a>
            <a href="/register" class="rounded-lg bg-black px-4 py-2 font-semibold text-white hover:bg-blue-500">
              Register
            </a>
            <% } %>
      </div>

  </header>

  <!-- Navbar Section -->
  <!-- make this separated from header to apply sticky effect -->
    <%if (categories) { %>
  <nav class="sticky top-0 z-10 flex h-14 w-full items-center justify-center bg-white">
    <style>
      .dropdown:hover,
      .dropdown.active {
        scale: 125%;
      }

      .dropdown:hover .dropdown-menu {
        display: block;
      }

      .dropdown-menu {
        display: none;
        position: absolute;
        top: 80%;
        width: max-content;
      }

      .dropdown-menu li:hover {
        scale: 105%;
        animation-duration: 200ms;
      }
    </style>
    <div class="container mx-auto flex items-center justify-center px-4 py-2">
      <ul class="flex space-x-14">
        <!-- Home Icon -->
        <li class="relative flex h-14 items-center">
          <a class="flex items-center hover:text-blue-500" href="/">
            <svg>
              <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
              <path d="M9 22V12h6v10" />
              <rect x="10" y="15" width="4" height="7" fill="white" />
            </svg>
          </a>
        </li>

        <!-- Dynamic Categories -->
        <% categories.forEach(category=> { %>
          <li class="dropdown <%= category === category.name ? 'active' : '' %> relative flex h-14 items-center">
            <a class="<%= category === category.name ? 'text-blue-500' : '' %> font-bold hover:text-blue-500"
              href="/<%= category.name %>">
              <%= category.displayName %>
            </a>
            <% if (category.subcategories && category.subcategories.length> 0) {
              %>
              <ul class="dropdown-menu absolute left-0 mt-2 w-48 bg-white shadow-lg">
                <% category.subcategories.forEach(sub=> { %>
                  <li>
                    <a class="block px-4 py-2 font-bold hover:bg-gray-200 hover:text-blue-500" href="<%= sub.link %>">
                      <%= sub.displayName %>
                    </a>
                  </li>
                  <% }) %>
              </ul>
              <% } %>
          </li>
          <% }) %>
      </ul>
    </div>
  </nav>
  <% } %> 
  <%- include(content) %>

    <footer
      class="flex flex-col items-center justify-between gap-8 border-t-2 border-t-zinc-300 p-6 text-center shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] xl:px-20">
      <!-- Original Footer Content -->
      <div class="container mx-auto mb-0 flex flex-row items-center justify-between">
        <p class="text-sm font-semibold text-slate-500">PTUDW Project</p>

        <div class="flex flex-row gap-4 text-sm text-slate-700 underline">
          <a href="/tos" class="hover:text-sky-500">Điều khoản dịch vụ</a>
          <a href="/privacy" class="hover:text-sky-500">Chính sách bảo mật</a>
          <a href="/contact" class="hover:text-sky-500">Liên hệ với chúng tôi</a>
        </div>
      </div>

      <!-- Separator Line -->
      <div class="my-4 mt-0 w-screen border-t-2 border-t-gray-300"></div>

      <!-- Additional Footer Section -->
      <div class="container mx-auto flex flex-row gap-8 text-sm text-gray-700 md:justify-between">
        <!-- Left Section -->
        <div class="w-1/4 text-left">
          <p class="font-bold">Hotline</p>
          <p>0988 666 999</p>
          <p class="mt-4 font-bold">Liên hệ quảng cáo</p>
          <p>0988 777 999</p>
        </div>

        <!-- Middle Section -->
        <div class="w-1/4 text-left">
          <p><strong>Tổng biên tập:</strong> Nguyễn Phúc An</p>
          <p><strong>Phó tổng biên tập:</strong> Trịnh Anh Tài</p>
          <p><strong>Phó tổng biên tập:</strong> Phạm Đình Khôi</p>
          <p><strong>Phó tổng biên tập:</strong> Nguyễn Quang Doãn</p>
          <p><strong>Phó tổng biên tập:</strong> Nguyễn Quốc Hưng ;P</p>
          <p><strong>Tổng thư ký tòa soạn:</strong> Văng Khánh Tường</p>
        </div>

        <!-- Right Section -->
        <div class="w-1/2 text-right">
          <p>Giấy phép xuất bản số 123/GP - BTTTT cấp ngày 01.12.2024</p>
          <p>© 2024-2024 Bản quyền thuộc về The Cipher.</p>
          <p>
            Cấm sao chép dưới mọi hình thức nếu không có sự chấp thuận bằng văn
            bản.
          </p>
        </div>
      </div>
    </footer>

    <!-- Scroll-to-top Button -->
    <button id="scrollToTopBtn"
      class="fixed bottom-6 right-6 z-50 hidden rounded-full bg-blue-500 p-3 text-white shadow-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-300">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
      </svg>
    </button>
</body>

</html>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Get the button
    const scrollToTopBtn = document.getElementById("scrollToTopBtn");

    // Show or hide the button depending on the scroll position
    window.addEventListener("scroll", () => {
      if (window.scrollY > 200) {
        scrollToTopBtn.classList.remove("hidden");
      } else {
        scrollToTopBtn.classList.add("hidden");
      }
    });

    // Scroll to the top of the page when the button is clicked
    scrollToTopBtn.addEventListener("click", () => {
      window.scrollTo({
        top: 0,
        behavior: "smooth",
      });
    });
    const dropdownBtn = document.getElementById("userDropdownBtn");
    const dropdownMenu = document.getElementById("userDropdownMenu");

    dropdownBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      dropdownMenu.classList.toggle("hidden");
    });

    window.addEventListener("click", () => {
      dropdownMenu.classList.add("hidden");
    });
  });

</script>