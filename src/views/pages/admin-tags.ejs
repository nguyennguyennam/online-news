<div class="mx-auto flex w-full max-w-screen-lg flex-col gap-4">
    <h1 class="text-2xl font-semibold">Manage Tags</h1>
  
    <% adminTags.forEach(tags => { %>
    <details tags-id="<%= tags._id %>" class="rounded-lg border-2 border-zinc-400">
      <summary
        class="flex w-full items-center justify-between px-4 py-2 marker:m-0 marker:appearance-none marker:p-0"
      >
        <h2 id="tags-name-<%= tags._id %>" class="font-semibold inline-block"><%= tags.tag %></h2>
        <div class="flex flex-row items-center gap-px">
          <button
            id="edit-btn-tags-<%= tags._id %>"
            class="flex items-center justify-center p-2 duration-200 hover:bg-zinc-200"
            onclick="startEditing('<%= tags._id %>', 'tags')"
            title="Edit"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 -960 960 960"
              class="size-6"
              aria-label="Edit"
            >
              <path
                d="M206.22-206.78h57.56l352.57-352.57-56.44-57-353.69 353.7v55.87Zm-52.44 106q-22.08 0-37.54-15.46t-15.46-37.54v-109.44q0-21.08 7.98-40.39 7.98-19.3 22.94-34.26l495.95-495.52q13.13-12.7 29.33-19.26 16.19-6.57 33.89-6.57 17.13 0 33.83 6.57 16.69 6.56 29.95 19.69l79.31 78.61q13.13 12.7 19.48 29.68 6.34 16.97 6.34 34.24 0 17.69-6.34 34.17-6.35 16.48-19.48 29.61L339-131.7q-14.96 14.96-34.26 22.94-19.3 7.98-40.39 7.98H153.78Zm593.78-589.65L691-747.56l56.56 57.13ZM587.91-587.91l-28-28.44 56.44 57-28.44-28.56Z"
              />
            </svg>
          </button>
          
          <div id="edit-form-tags-<%= tags._id %>" class="hidden">
            <input
              type="text"
              id="edit-input-tags-<%= tags._id %>"
              class="border p-2"
              value="<%= tags.tag %>"
            />
            <button
              onclick="confirmEdit('<%= tags._id %>','tags')"
              class="p-2 bg-blue-500 text-white rounded"
            >
              Confirm
            </button>
            <button
              onclick="cancelEdit('<%= tags._id %>','tags')"
              class="p-2 bg-gray-300 text-black rounded"
            >
              Cancel
            </button>
          </div>
  
          <button
            class="flex items-center justify-center p-2 duration-200 hover:bg-zinc-200"
            onclick="confirmDelete('<%= tags._id %>')"
            title="Delete"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 -960 960 960"
              class="size-6"
              aria-label="Delete"
            >
              <path
                d="M273.78-100.78q-44.3 0-75.15-30.85-30.85-30.85-30.85-75.15v-507q-22.09 0-37.54-15.46-15.46-15.46-15.46-37.54 0-22.09 15.46-37.55 15.45-15.45 37.54-15.45H347q0-22.09 15.46-37.55 15.45-15.45 37.54-15.45h158.87q22.09 0 37.54 15.45 15.46 15.46 15.46 37.55h180.35q22.09 0 37.54 15.45 15.46 15.46 15.46 37.55 0 22.08-15.46 37.54-15.45 15.46-37.54 15.46v507q0 44.3-30.85 75.15-30.85 30.85-75.15 30.85H273.78Zm412.44-613H273.78v507h412.44v-507ZM396.61-280.57q19.26 0 32.74-13.47 13.48-13.48 13.48-32.74v-267.57q0-19.26-13.48-32.74t-32.74-13.48q-19.26 0-33.02 13.48-13.76 13.48-13.76 32.74v267.57q0 19.26 13.76 32.74 13.76 13.47 33.02 13.47Zm167.35 0q19.26 0 32.74-13.47 13.47-13.48 13.47-32.74v-267.57q0-19.26-13.47-32.74-13.48-13.48-32.74-13.48t-33.03 13.48q-13.76 13.48-13.76 32.74v267.57q0 19.26 13.76 32.74 13.77 13.47 33.03 13.47ZM273.78-713.78v507-507Z"
              />
            </svg>
          </button>
  
          <div
            id="delete-modal"
            style="
              display: none !important; 
              position: fixed; 
              inset: 0; 
              background-color: rgba(0, 0, 0, 0.5); 
              z-index: 1000; 
              display: flex; 
              justify-content: center; 
              align-items: center;"
            class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"
          >
            <div class="model-content">
              <div class="bg-white p-6 rounded-lg shadow-lg text-center">
                <p class="mb-4 text-lg font-semibold">Bạn chắc chắn muốn xóa tag này chứ?</p>
                <div class="flex justify-center gap-4">
                <button
                  id="cancel-btn"
                  class="rounded bg-gray-300 px-4 py-2 text-black"
                  onclick="closeModal()"
                >
                  Cancel
                </button>
                <button
                  id="confirm-btn"
                  class="rounded bg-red-500 px-4 py-2 text-white"
                >
                  Confirm
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </summary>
  </details>
  <% }) %>
</div>

<script>
  function startEditing(entityId, entityType) {
    // Hide the text and edit button
    document.getElementById(`${entityType}-name-${entityId}`).style.display =
      "none";
    document.getElementById(
      `edit-btn-${entityType}-${entityId}`,
    ).style.display = "none";

    // Show the input form
    document
      .getElementById(`edit-form-${entityType}-${entityId}`)
      .classList.remove("hidden");
  }

  function confirmEdit(entityId, entityType) {
    // Get the new value from the input field
    const newValue = document.getElementById(
      `edit-input-${entityType}-${entityId}`,
    ).value;

    // Update the text content
    document.getElementById(`${entityType}-name-${entityId}`).textContent =
      newValue;

    // Reset visibility
    document.getElementById(`${entityType}-name-${entityId}`).style.display =
      "inline-block";
    document.getElementById(
      `edit-btn-${entityType}-${entityId}`,
    ).style.display = "flex";
    document
      .getElementById(`edit-form-${entityType}-${entityId}`)
      .classList.add("hidden");

    // Optional: Send an update request to the server via fetch or AJAX
    // Example:
    // fetch(`/update-${entityType}/${entityId}`, {
    //   method: 'POST',
    //   headers: { 'Content-Type': 'applitagsion/json' },
    //   body: JSON.stringify({ name: newValue }),
    // });
  }

  function cancelEdit(entityId, entityType) {
    // Reset visibility
    document.getElementById(`${entityType}-name-${entityId}`).style.display =
      "inline-block";
    document.getElementById(
      `edit-btn-${entityType}-${entityId}`,
    ).style.display = "flex";
    document
      .getElementById(`edit-form-${entityType}-${entityId}`)
      .classList.add("hidden");
  }

  //Hàm dùng để xử lí nút delete
  function confirmDelete(tagsId) {
    const modal = document.getElementById("delete-modal");
    const confirmButton = document.getElementById("confirm-btn");

    // Hiển thị modal
    modal.style.display = "flex";

    // Gắn sự kiện xóa vào nút Confirm
    confirmButton.onclick = () => {
      fetch(`./delete/${tagsId}`, { method: "DELETE" })
        .then((response) => {
          if (response.ok) {
            lotagsion.reload(); // Reload trang sau khi xóa thành công
          } else {
            alert("Xóa thất bại!");
          }
        })
        .tagsch((error) => console.error("Error:", error));
    };
  }

  function closeModal() {
    const modal = document.getElementById("delete-modal");
    modal.style.display = "none";
  }
</script>
